# 提案手法の今後の改善策 (Future Work)

本プロジェクト「ハイブリッド追跡型VBTシステム (YOLO + MediaPipe)」における、現状の課題と将来的な改善案をまとめました。卒論の「今後の展望」や、次期開発のロードマップとして活用してください。

---

## 1. 精度向上に関する改善 (Accuracy)

### ① 側面アングルにおける自動キャリブレーションの高度化
*   **現状:** 横向き（Side View）では手首が重なるため、手首間距離（81cm）によるキャリブレーションが破綻します。現在は「手首距離 < 100px」の場合に「体幹長=50cm」と仮定するロジックで回避していますが、体格差による誤差が残ります。
*   **改善策:**
    *   **プレート径による補正:** YOLOで「バーベルのプレート（通常45cm）」を検出し、その直径を基準にスケールを算出する手法を併用する。
    *   **3D姿勢推定の活用:** MediaPipeのZ軸（深度）情報を活用し、カメラに対する体の角度を推定して、投影誤差を数学的に補正する。

### ② 動画の向き（縦・横）の完全自動判定
*   **現状:** 動画の解像度（縦長・横長）とファイル名から回転の可否を判定していますが、`front_5rep`（縦動画だが回転しない方がよい）のような例外があります。
*   **改善策:**
    *   **多方向推論:** 最初の数フレームに対し、「そのまま」「90度回転」「270度回転」の3パターンで姿勢推定を行い、**姿勢の信頼度（Confidence Score）が最も高い向き**を自動採用するロジックを実装する。

---

## 2. ロバスト性（安定性）の向上 (Robustness)

### ③ ターゲット追跡の再ロック機構 (Re-Identification)
*   **現状:** 最初の1フレーム目で検出した領域（Immediate Lock）を最後まで使い続けます。被写体が大きく動いてフレームアウトしたり、一度見失ったりすると復帰できません。
*   **改善策:**
    *   **定期的監視:** 数秒おき、または姿勢信頼度が低下した瞬間にYOLOを再実行し、ターゲット位置を修正する機能を実装する（以前試作したが、誤検出リスクのため無効化した経緯あり。条件の精査が必要）。
    *   **オプティカルフロー:** MediaPipeが失敗したフレーム間を、画像処理的な追跡（KLT Tracker等）で補間する。

### ④ 複数人環境でのIDスイッチ対策
*   **現状:** 画面内で最も大きく検出された人物をターゲットとしますが、補助者（スポッター）が近づいた場合にターゲットが移る可能性があります。
*   **改善策:**
    *   **特徴量マッチング:** 最初に検出した人物の「服の色」や「ヒストグラム」を記憶し、スポッターと区別するReID（Re-Identification）技術を導入する。

---

## 3. 機能拡張・ユーザビリティ (Usability)

### ⑤ 自動レップカウントの精度向上
*   **現状:** 速度のゼロクロス（正負の反転）やY座標の極値でカウントしていますが、小刻みな揺れをカウントしてしまう場合があります（特にサイドビュー）。
*   **改善策:**
    *   **状態遷移マシン (State Machine):** 「静止 → 下降（Eccentric） → ボトム → 上昇（Concentric） → トップ」という5つの状態を厳密に定義し、シーケンス通りに進んだ場合のみレップとして認めるロジックを導入する。

### ⑥ GUIの軽量化とリアルタイム性
*   **現状:** PythonのOpenCVウィンドウで描画していますが、グラフ描画（Matplotlib）がボトルネックとなりFPSが低下する場合がありす。
*   **改善策:**
    *   グラフ描画を別スレッド化（非同期処理）するか、軽量な描画ライブラリ（PyQtGraphなど）に移行して、リアルタイムFPSを60fps以上で安定させる。

---

## 4. 処理速度の最適化 (Performance)

*   **TensorRT / ONNX Runtime:** 現在のYOLO（PyTorch）とMediaPipe（TFLite）を、より高速な推論エンジンに変換して実行する。
*   **エッジデバイス対応:** スマホやRaspberry Piでも動作するように軽量モデル（YOLO11n-segなど）への最適化を進める。
