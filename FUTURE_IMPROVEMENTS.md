# 提案手法の今後の改善策 (Future Work)

本プロジェクト「ハイブリッド追跡型VBTシステム (YOLO + MediaPipe)」における、現状の課題と将来的な改善案をまとめました。卒論の「今後の展望」や、次期開発のロードマップとして活用してください。
---

## 開発者メモ (Developer Field Notes)
*   **制限事項 (Known Limitation):** 手首や足先など、身体の一部がフレームアウトしている動画（例: `right_9rep.mp4`）では、MediaPipeのキーポイント推定が不安定になり、正常な計測ができませんでした。
    *   **現象:** 特に「肘（Elbow）」がプレートや身体で隠れる（オクルージョン）と、その先の「手首（Wrist）」の座標が大きく飛ぶ現象が確認されました。
    *   **結論:** 本システム（MediaPipeベース）が正常に動作するためには、「頭から膝までを含む全身が画角に収まっていること」が必須要件であると結論付けました。無理な回転補正などは行わず、撮影条件の制約として扱います。

## 1. 精度向上に関する改善 (Accuracy)

### ① 側面アングルにおける自動キャリブレーションの高度化
*   **現状:** 横向き（Side View）では手首が重なるため、手首間距離（81cm）によるキャリブレーションが破綻します。現在は「手首距離 < 100px」の場合に「体幹長=50cm」と仮定するロジックで回避していますが、体格差による誤差が残ります。
*   **改善策:**
    *   **3D姿勢推定の活用:** MediaPipeのZ軸（深度）情報を活用し、カメラに対する体の角度を推定して、投影誤差を数学的に補正する。

---

## 2. ロバスト性（安定性）の向上 (Robustness)

### ② オクルージョン（隠れ）への対策と補正
*   **現状:** プレートや身体で肘が隠れると、階層的なトポロジー構造の破綻により、従属する手首座標が大きく跳躍（誤検出）します。
*   **改善策:**
    *   **キネマティック制約 (Kinematic Constraints):** 人体の構造的制約を利用します。「肩-肘」「肘-手首」の長さは一定であるため、肩から物理的にあり得ない距離に手首が飛んだ場合、それを異常値として棄却し、有効範囲 (Range of Motion) 内にクランプする補正ロジックを導入する。
    *   **物体追跡とのフュージョン:** 手首のキーポイントが不安定でも、「バーベル（プレート）」自体はYOLOの物体検出で安定して追跡可能です。「手首は常にバーベルの近くにある」という拘束条件を導入し、手首座標がプレート位置から乖離した場合に、信頼度の高いバーベル位置へ強制的に補正する。

### ③ ターゲット追跡の再ロック機構 (Re-Identification)
*   **現状:** 最初の1フレーム目で検出した領域（Immediate Lock）を最後まで使い続けます。被写体が大きく動いてフレームアウトしたり、一度見失ったりすると復帰できません。
*   **改善策:**
    *   **定期的監視 (Lost Recovery Logic):**
        1.  **監視:** `yolo11_mediapipe_estimator.py` 内で、MediaPipeがランドマークを検出できなかったフレーム数をカウントする (`lost_tracking_count`)。
        2.  **判定:** 連続して規定回数（例: 30フレーム≒1秒）見失った場合、「ターゲットロスト」と判定する。
        3.  **リセット:** `self.locked_box = None` にリセットし、検索フェーズ（YOLO実行）に移行する。
        4.  **再検出:** 次のフレームから全画面スキャンを行い、再度最も大きな人物を検出してロックし直す。
    *   **オプティカルフロー:** MediaPipeが失敗したフレーム間を、画像処理的な追跡（KLT Tracker等）で補間する。

### ④ 複数人環境でのIDスイッチ対策
*   **現状:** 画面内で最も大きく検出された人物をターゲットとしますが、補助者（スポッター）が近づいた場合にターゲットが移る可能性があります。
*   **改善策:**
    *   **特徴量マッチング:** 最初に検出した人物の「服の色」や「ヒストグラム」を記憶し、スポッターと区別するReID（Re-Identification）技術を導入する。

---

## 3. 機能拡張・ユーザビリティ (Usability)

### ⑤ 自動レップカウントの精度向上
*   **現状:** 速度のゼロクロス（正負の反転）やY座標の極値でカウントしていますが、小刻みな揺れをカウントしてしまう場合があります（特にサイドビュー）。
*   **改善策:**
    *   **状態遷移マシン (State Machine):** 「静止 → 下降（Eccentric） → ボトム → 上昇（Concentric） → トップ」という5つの状態を厳密に定義し、シーケンス通りに進んだ場合のみレップとして認めるロジックを導入する。

### ⑥ GUIの軽量化とリアルタイム性
*   **現状:** PythonのOpenCVウィンドウで描画していますが、グラフ描画（Matplotlib）がボトルネックとなりFPSが低下する場合がありす。
*   **改善策:**
    *   グラフ描画を別スレッド化（非同期処理）するか、軽量な描画ライブラリ（PyQtGraphなど）に移行して、リアルタイムFPSを60fps以上で安定させる。

---

## 4. 処理速度の最適化 (Performance)

*   **TensorRT / ONNX Runtime:** 現在のYOLO（PyTorch）とMediaPipe（TFLite）を、より高速な推論エンジンに変換して実行する。
*   **エッジデバイス対応:** スマホやRaspberry Piでも動作するように軽量モデル（YOLO11n-segなど）への最適化を進める。
